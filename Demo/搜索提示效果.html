<!DOCtype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>搜索提示功能</title>
		<script src="../js/jquery-2.1.1.min.js"></script>
		<style>
		zwl { background-color: #FFD700}
		</style>
	</head>
	<body>
		<input id="search" type="text" value="" placeholder="搜索:黄帝" autofocus="true">
		<ul>
			<li id="findSize"></li>
		</ul>
		<article contenteditable="false">
			<p><font color="red"><i>黄帝</i></font>者，少典之子，姓公孙，名曰轩辕。生而神灵，弱而能言，幼而徇齐，长而敦敏，成而聪明。轩辕之时，神农氏世衰。诸侯相侵伐，暴虐百姓，而神农氏弗能征。於是轩辕乃习用干戈，以征不享，诸侯咸来宾从。而蚩尤最为暴，莫能伐。炎帝欲侵陵诸侯，诸侯咸归轩辕。轩辕乃修德振兵，治五气，蓺五种，抚万民，度四方，教熊罴貔貅貙虎，以与炎帝战於阪泉之野。三战，然後得其志。蚩尤作乱，不用帝命。於是黄帝乃徵师诸侯，与蚩尤战於涿鹿之野，遂禽杀蚩尤。而诸侯咸尊轩辕为天子，代神农氏，是为黄帝。天下有不顺者，黄帝从而征之，平者去之，披山通道，未尝宁居。</p>

			<p>东至于海，登丸山，及岱宗。西至于空桐，登鸡头。南至于江，登熊、湘。北逐荤粥，合符釜山，而邑于涿鹿之阿。迁徙往来无常处，以师兵为营卫。官名皆以云命，为云师。置左右大监，监于万国。万国和，而鬼神山川封禅与为多焉。获宝鼎，迎日推筴。举风后、力牧、常先、大鸿以治民。顺天地之纪，幽明之占，死生之说，存亡之难。时播百穀草木，淳化鸟兽蟲蛾，旁罗日月星辰水波土石金玉，劳勤心力耳目，节用水火材物。有土德之瑞，故号黄帝。</p>

			<p>【畅途网】您预订的2014-12-27 12:20杭州市 杭州北站 到铜陵，车票1张。乘车站地址：莫干山路766号，取票时间：6:00-19:00。凭取票号940058121和密码013748取票。取票地点:自助取票机（代理取票入口）。请预留取票时间，此短信妥善保管。客服电话：4006008080。</p>

			<p>黄帝居轩辕之丘，而娶於西陵之女，是为嫘祖。嫘祖为黄帝正妃，生二子，其後皆有天下：其一曰玄嚣，是为青阳，青阳降居江水；其二曰昌意，降居若水。昌意娶蜀山氏女，曰昌仆，生高阳，高阳有圣德焉。黄帝崩，葬桥山。其孙昌意之子高阳立，是为帝颛顼也。</p>

			<p>帝颛顼高阳者，黄帝之孙而昌意之子也。静渊以有谋，疏通而知事；养材以任地，载时以象天，依鬼神以制义，治气以教化，絜诚以祭祀。北至于幽陵，南至于交阯，西至于流沙，东至于蟠木。动静之物，大小之神，日月所照，莫不砥属。</p>

			<p>&lt;span&gt; &staff master:allows you to wield magic staves&lt;/span&gt;</p>

			<p>&lt;b&gt;staff master:allows you to wield magic staves&lt;/b&gt;</p>
			
			<p>&lt;p&gt;staff master:allows you to wield magic staves&lt;/p&gt;</p>

			<p>&lt;div&gt;staff master:allows you to wield magic staves&lt;/div&gt;</p>

			<p>var str = $(this).val().replace(/(.{2})/g, '$1-');</p>

			<p>高辛生而神灵，自言其名。普施利物，不於其身。聪以知远，明以察微。顺天之义，知民之急。仁而威，惠而信，脩身而天下服。取地之财而节用之，抚教万民而利诲之，历日月而迎送之，明鬼神而敬事之。其色郁郁，其德嶷嶷。其动也时，其服也士。帝喾溉执中而遍天下，日月所照，风雨所至，莫不从服。</p>

			<p>帝喾娶陈锋氏女，生放勋。娶娵訾氏女，生挚。帝喾崩，而挚代立。帝挚立，不善，而弟放勋立，是为帝尧。</p>

			<p>帝尧者，放勋。其仁如天，其知如神。就之如日，望之如云。富而不骄，贵而不舒。黄收纯衣，彤车乘白马。能明驯德，以亲九族。九族既睦，便章百姓。百姓昭明，合和万国。</p>
			<p>abc</p>
		</article>

	</body>

</html>
<script>
/*
	搜索提示功能
	输入文字,显示位置与得到的数量

	1.支持中文搜索
	2.支持英文搜索
	3.支持数字搜索
	4.支持 . / \ $ 等搜索; 如 (/(.{2})/g, '$1-')
	5.支持html搜索; 如 <div>

	不支持
	1.实体字符搜索,如在搜索t是,&lt;中的t也会查询出来

	将要支持
	1.上下选择提示
	2.文字的替换功能
	---------------------------------------------------
	zwl <www.myos.me> 2015-1-6
*/
$(function() {

	$('input').keyup(function(e) {
		var showVal = '';
		var val = $('#search').val().trim();

		console.log('Search Txt: ' + val);

		// 1.输入处理,禁止输入连续空格
		if (val == '') {
			// 如果输入是空,则不能输入了
			$(this).val('');

			// 清空已经有选择过的标记
			$('font').each(function() {
				$(this).after($(this).text()).remove();
			});

			// 提示个数清空
			$('#findSize').html('0');

			return;
		};

		// 2.处理html标签中的< 或 >
		if (val.indexOf('<') > -1) {
			val = val.replace(/</g, '&lt;');
			console.log('New '+ val);
		}
		if (val.indexOf('>') > -1) {
			val = val.replace(/>/g, '&gt;');
			console.log('New '+ val);
		}

		// 3.处理特殊字符,分享正则匹配用字和显示用字内容
		// var specialReg = new RegExp('\\(|\\)|\\.|\\$|\\}', 'gi');
		var specialReg = new RegExp('[\(\)\{\}\$\.]', 'gi');
		// var replaceReg = '';
		
		if (specialReg.test(val)) {

			console.log(val.match(specialReg));
			showVal = val;

			// 匹配特殊的字符:
			// ( ) { } $ .
			val = val.replace(/([\(\)\{\}\$\.])/g, '\\$1');

		} else {
			showVal = val;
		}

		// console.log(val);

		// 4.匹配生成代码
		var myRegExp = new RegExp(val, 'g');
		console.log(myRegExp)

		$('p').each(function() {
			// debugger
			var thisHTML = $(this).text();

			thisHTML = thisHTML.replace(/</g, '&lt;');
			thisHTML = thisHTML.replace(/>/g, '&gt;');
			var newHTML = thisHTML.replace(myRegExp, '<font color="red"><zwl>' + showVal + '</zwl></font>');

			$(this).html(newHTML);
		});

		// 5.显示查询个数
		$('#findSize').text($('font').size());
	})
})
</script>